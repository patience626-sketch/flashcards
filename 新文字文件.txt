<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å­—å¡å°å¹«æ‰‹ - ä¸­æ–‡â†’è‹±æ–‡ æ‹¼å­—ç·´ç¿’</title>
<style>
  :root{
    --bg:#fffaf3; --card:#fff; --accent:#ff7a6b; --muted:#6b6b6b;
    --pill:#f6e9e6;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC", "Microsoft JhengHei",sans-serif;
       margin:0;background:linear-gradient(180deg,#fffaf3,#fff);color:#222;padding:20px;display:flex;align-items:center;justify-content:center;min-height:100vh}
  .wrap{width:100%;max-width:740px;background:var(--card);border-radius:14px;box-shadow:0 8px 30px rgba(30,30,30,0.08);padding:22px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:10px;flex-wrap:wrap}
  button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
  button.ghost{background:transparent;color:var(--accent);border:2px solid var(--pill);font-weight:700}
  .card{margin-top:16px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fffaf8);display:grid;grid-template-columns:1fr 260px;gap:16px;align-items:center}
  .left{padding:8px}
  .chinese{font-size:24px;font-weight:700;margin:6px 0}
  .imgwrap{background:#fff;border-radius:10px;padding:8px;display:flex;align-items:center;justify-content:center;height:220px;overflow:hidden}
  .imgwrap img{max-width:100%;max-height:100%;border-radius:8px}
  .audioBtn{margin-top:10px;display:inline-block;padding:8px 12px;border-radius:10px;background:var(--pill);border:1px solid rgba(0,0,0,0.05);cursor:pointer}
  .right{display:flex;flex-direction:column;gap:8px;align-items:center}
  input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid #eee;font-size:18px}
  .actions{display:flex;gap:8px;margin-top:8px;width:100%}
  .result{height:34px;font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;margin-top:6px}
  .meta{display:flex;gap:8px;align-items:center;font-size:14px;color:var(--muted)}
  .small{font-size:13px;color:#777}
  footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
  .hint{background:#fff8e9;padding:8px;border-radius:8px;font-size:14px}
  .settings{display:flex;gap:8px;align-items:center}
  @media(max-width:720px){
    .card{grid-template-columns:1fr;align-items:stretch}
    .imgwrap{height:200px}
    .right{align-items:stretch}
  }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="å­—å¡å°å¹«æ‰‹">
    <header>
      <h1>å­—å¡å°å¹«æ‰‹ â€” ä¸­æ–‡ â†’ è‹±æ–‡ æ‹¼å­—ç·´ç¿’</h1>
      <div class="controls">
        <button id="randBtn" title="åˆ‡æ›ç‚ºéš¨æ©Ÿé¡Œåº">éš¨æ©Ÿæ¨¡å¼</button>
        <button id="replayBtn" title="é‡æ’­ç™¼éŸ³">é‡æ’­ç™¼éŸ³</button>
        <button id="showAnswerBtn" class="ghost" title="é¡¯ç¤ºç­”æ¡ˆ">é¡¯ç¤ºç­”æ¡ˆ</button>
      </div>
    </header>

    <div class="card" id="card">
      <div class="left">
        <div class="imgwrap" id="imgwrap" aria-hidden="false">
          <img id="cardImg" src="" alt="å­—å¡åœ–ç‰‡">
        </div>
        <div class="chinese" id="chinese">ä¸­æ–‡é¡Œç›®</div>
        <div>
          <button class="audioBtn" id="audioBtn">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
          <span class="small" style="margin-left:10px;color:#666">ï¼ˆå¯ä½¿ç”¨ç€è¦½å™¨èªéŸ³æˆ–å¤–éƒ¨éŸ³æª”ï¼‰</span>
        </div>
      </div>

      <div class="right">
        <label for="answer" class="small">è«‹ç”¨éµç›¤è¼¸å…¥è‹±æ–‡å–®å­—ï¼š</label>
        <input id="answer" type="text" placeholder="è¼¸å…¥ç­”æ¡ˆï¼ŒæŒ‰ Enter æª¢æŸ¥">
        <div class="actions">
          <button id="checkBtn">æª¢æŸ¥</button>
          <button id="nextBtn" class="ghost">ä¸‹ä¸€é¡Œ</button>
          <button id="hintBtn" class="ghost">æç¤ºï¼ˆé¦–å­—æ¯ï¼‰</button>
        </div>
        <div class="result" id="result" aria-live="polite"></div>
        <div class="meta">
          <div id="progress">é¡Œç›® 0 / 0</div>
          <div id="score" style="margin-left:8px">æ­£ç¢ºç‡ï¼š0%</div>
        </div>
      </div>
    </div>

    <footer>
      <div class="hint" id="hintArea">æç¤ºï¼šæŒ‰ã€Œæç¤ºã€å¯ä»¥çœ‹åˆ°é¦–å­—æ¯ï¼›æŒ‰ã€Œé¡¯ç¤ºç­”æ¡ˆã€æœƒé¡¯ç¤ºå®Œæ•´ç­”æ¡ˆã€‚</div>

      <div class="settings">
        <label class="small">é¡Œåº«ä¾†æºï¼š
          <select id="sourceSelect">
            <option value="embedded">å…§å»ºé¡Œåº«</option>
            <option value="external">å¤–éƒ¨ JSONï¼ˆç¶²å€ï¼‰</option>
          </select>
        </label>
        <input id="externalUrl" type="text" placeholder="å¤–éƒ¨ JSON URLï¼ˆé¸å¤–éƒ¨æ™‚å¡«ï¼‰" style="width:260px;padding:8px;border-radius:8px;border:1px solid #eee">
        <button id="reloadBtn" class="ghost">è¼‰å…¥é¡Œåº«</button>
      </div>
    </footer>
  </div>

<script>
/*
  CARD DATA STRUCTUREï¼š
  cards = [
    {
      chinese: "è˜‹æœ",
      image: "https://...jpg",
      answer: "apple",
      audio: null OR "https://...mp3"  // optional
    }, ...
  ]
  - audio è‹¥ç•™ç©ºï¼Œç¨‹å¼æœƒç”¨ç€è¦½å™¨ SpeechSynthesis æ’­æ”¾è‹±æ–‡å–®å­—
*/

let cards = [
  { chinese:"è˜‹æœ", image:"https://upload.wikimedia.org/wikipedia/commons/1/15/Red_Apple.jpg", answer:"apple", audio:null },
  { chinese:"ç‹—", image:"https://upload.wikimedia.org/wikipedia/commons/6/6e/Golde33443.jpg", answer:"dog", audio:null },
  { chinese:"è²“", image:"https://upload.wikimedia.org/wikipedia/commons/3/3a/Cat03.jpg", answer:"cat", audio:null },
  { chinese:"é¦™è•‰", image:"https://upload.wikimedia.org/wikipedia/commons/8/8a/Banana-Single.jpg", answer:"banana", audio:null }
];

let state = {
  idxs: [], currentIndex: 0, correctCount:0, triedCount:0, random:false
};

const el = {
  chinese: document.getElementById("chinese"),
  cardImg: document.getElementById("cardImg"),
  audioBtn: document.getElementById("audioBtn"),
  answer: document.getElementById("answer"),
  checkBtn: document.getElementById("checkBtn"),
  nextBtn: document.getElementById("nextBtn"),
  hintBtn: document.getElementById("hintBtn"),
  result: document.getElementById("result"),
  progress: document.getElementById("progress"),
  score: document.getElementById("score"),
  randBtn: document.getElementById("randBtn"),
  replayBtn: document.getElementById("replayBtn"),
  showAnswerBtn: document.getElementById("showAnswerBtn"),
  reloadBtn: document.getElementById("reloadBtn"),
  sourceSelect: document.getElementById("sourceSelect"),
  externalUrl: document.getElementById("externalUrl"),
  hintArea: document.getElementById("hintArea")
};

function initIndexes() {
  state.idxs = cards.map((_,i)=>i);
  if(state.random) shuffle(state.idxs);
  state.currentIndex = 0;
  state.correctCount = 0;
  state.triedCount = 0;
  saveProgress();
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    let j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function render() {
  if(cards.length===0){
    el.chinese.textContent="é¡Œåº«ç‚ºç©º";
    el.cardImg.src="";
    el.progress.textContent="é¡Œç›® 0 / 0";
    el.score.textContent="æ­£ç¢ºç‡ï¼š0%";
    return;
  }
  let idx = state.idxs[state.currentIndex];
  let card = cards[idx];
  el.chinese.textContent = card.chinese;
  el.cardImg.src = card.image || "";
  el.answer.value = "";
  el.result.textContent = "";
  el.progress.textContent = `é¡Œç›® ${state.currentIndex+1} / ${cards.length}`;
  updateScore();
  // pre-load audio if given
  currentAudioSrc = card.audio || null;
}

function updateScore(){
  let percent = state.triedCount===0?0:Math.round((state.correctCount/state.triedCount)*100);
  el.score.textContent = `æ­£ç¢ºç‡ï¼š${percent}%ï¼ˆ${state.correctCount}/${state.triedCount}ï¼‰`;
}

function playAudioForCurrent() {
  if(cards.length===0) return;
  let idx = state.idxs[state.currentIndex];
  let c = cards[idx];
  if(c.audio){
    // play external mp3
    let a = new Audio(c.audio);
    a.play().catch(e=>{console.warn(e); speakText(c.answer); });
  } else {
    // use Web Speech API TTS (è‹±æ–‡)
    speakText(c.answer);
  }
}

function speakText(txt){
  if(!('speechSynthesis' in window)){ console.warn("TTS not supported"); return; }
  window.speechSynthesis.cancel();
  let u = new SpeechSynthesisUtterance(txt);
  u.lang = 'en-US';
  u.rate = 0.9;
  window.speechSynthesis.speak(u);
}

function checkAnswer() {
  if(cards.length===0) return;
  let user = el.answer.value.trim().toLowerCase();
  let idx = state.idxs[state.currentIndex];
  let correct = (cards[idx].answer||"").toLowerCase();
  state.triedCount++;
  if(user === correct){
    state.correctCount++;
    el.result.textContent = "âœ” æ­£ç¢ºï¼å¾ˆæ£’ï¼";
    el.result.style.color = "green";
    saveProgress();
    // small auto-move to next after delay
    setTimeout(()=>{ nextCard(); }, 700);
  } else {
    el.result.textContent = "âŒ å†è©¦ä¸€æ¬¡æˆ–æŒ‰æç¤º / é¡¯ç¤ºç­”æ¡ˆ";
    el.result.style.color = "crimson";
    saveProgress();
  }
  updateScore();
}

function nextCard(){
  if(cards.length===0) return;
  state.currentIndex = (state.currentIndex+1) % cards.length;
  render();
}

function prevCard(){
  if(cards.length===0) return;
  state.currentIndex = (state.currentIndex-1 + cards.length) % cards.length;
  render();
}

function showHint(){
  if(cards.length===0) return;
  let idx = state.idxs[state.currentIndex];
  let ans = (cards[idx].answer||"");
  if(!ans) return;
  el.result.textContent = `æç¤ºï¼šé¦–å­—æ¯ç‚ºã€Œ${ans[0]}ã€`;
  el.result.style.color = "#5a5a5a";
}

function showAnswer(){
  if(cards.length===0) return;
  let idx = state.idxs[state.currentIndex];
  let ans = (cards[idx].answer||"");
  el.answer.value = ans;
  el.result.textContent = `ç­”æ¡ˆï¼š${ans}`;
  el.result.style.color = "#333";
  // treat as tried but not automatically correct
  state.triedCount++;
  updateScore();
  saveProgress();
}

// localStorage for progress & current cards (basic)
function saveProgress(){
  try{
    let data = { correctCount: state.correctCount, triedCount: state.triedCount, timestamp: Date.now() };
    localStorage.setItem("flash_progress", JSON.stringify(data));
  }catch(e){console.warn(e)}
}

function loadProgress(){
  try{
    let raw = localStorage.getItem("flash_progress");
    if(raw){
      let d = JSON.parse(raw);
      state.correctCount = d.correctCount || 0;
      state.triedCount = d.triedCount || 0;
    }
  }catch(e){}
}

// allow external JSON load
async function loadExternal(url){
  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error("è¼‰å…¥å¤±æ•—ï¼š" + res.status);
    const data = await res.json();
    if(!Array.isArray(data)) throw new Error("JSON æ ¼å¼éœ€ç‚ºé™£åˆ—");
    // basic validation
    cards = data.map(item=>{
      return {
        chinese: item.chinese || item.zh || item.label || "",
        image: item.image || item.img || "",
        answer: item.answer || item.en || item.word || ""
      };
    });
    initIndexes(); render();
    alert("å¤–éƒ¨é¡Œåº«è¼‰å…¥å®Œæˆï¼Œé¡Œç›®æ•¸ï¼š" + cards.length);
  }catch(e){
    alert("è¼‰å…¥å¤–éƒ¨é¡Œåº«å¤±æ•—ï¼š" + e.message);
    console.error(e);
  }
}

// events
el.audioBtn.addEventListener('click', ()=> playAudioForCurrent());
el.replayBtn.addEventListener('click', ()=> playAudioForCurrent());
el.checkBtn.addEventListener('click', ()=> checkAnswer());
el.nextBtn.addEventListener('click', ()=> nextCard());
el.hintBtn.addEventListener('click', ()=> showHint());
el.showAnswerBtn.addEventListener('click', ()=> showAnswer());
el.randBtn.addEventListener('click', ()=>{
  state.random = !state.random;
  el.randBtn.textContent = state.random? "éš¨æ©Ÿæ¨¡å¼ï¼ˆONï¼‰":"éš¨æ©Ÿæ¨¡å¼ï¼ˆOFFï¼‰";
  initIndexes(); render();
});
el.reloadBtn.addEventListener('click', ()=>{
  if(el.sourceSelect.value==="external"){
    let url = el.externalUrl.value.trim();
    if(!url) { alert("è«‹è¼¸å…¥å¤–éƒ¨ JSON çš„ URL"); return; }
    loadExternal(url);
  } else {
    // reload embedded
    // restore initial embedded deck (we assume original cards var is initial deck)
    // if you modified cards in devtools, refreshing page loads original embedded data.
    initIndexes(); render();
    alert("å·²è¼‰å…¥å…§å»ºé¡Œåº«");
  }
});

// Enter key on input triggers check
el.answer.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ checkAnswer(); }
});

// initial boot
loadProgress();
initIndexes();
render();

/* OPTIONAL: keyboard shortcuts
   N = ä¸‹ä¸€é¡Œ, P = ä¸Šä¸€é¡Œ, Space = æ’­æ”¾ç™¼éŸ³
*/
document.addEventListener('keydown', (e)=>{
  if(e.target.tagName === 'INPUT') return; // avoid conflict
  if(e.key === 'n' || e.key === 'N') nextCard();
  if(e.key === 'p' || e.key === 'P') prevCard();
  if(e.code === 'Space') { e.preventDefault(); playAudioForCurrent(); }
});
</script>
</body>
</html>
